<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="Truonglv_YetiShareBridge" title="[tl] YetiShare Bridge" version_string="1.0.0" version_id="1000100" url="" install_callback_class="Truonglv_YetiShareBridge_Installer" install_callback_method="install" uninstall_callback_class="Truonglv_YetiShareBridge_Installer" uninstall_callback_method="uninstall">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates>
    <template title="yetishare_bridge_option_template_vipMapping"><![CDATA[<xen:require js="js/Truonglv/YetiShareBridge/options.min.js" />

<style>
	.YetiShareBridge_InputGroup {
		display: flex;
		align-items: center;
	}
	.YetiShareBridge_InputGroup .textCtrl {
		margin-top: 0 !important;
		margin-bottom: 0;
	}
	.YetiShareBridge_InputSpacer {
		width: 20px;
	}
</style>

<xen:controlunit label="{$preparedOption.title}" hint="{$preparedOption.hint}">
	<xen:explain>{xen:raw $preparedOption.explain}</xen:explain>
	<xen:html>
		<ul>
			<xen:foreach loop="$choices" key="$counter" value="$choice">
				<li class="CensorWordOptionListener YetiShareBridge_InputGroup">
					<xen:select name="{$fieldPrefix}[{$preparedOption.option_id}][{$counter}][user_group_id]" 
								value="{$choice.user_group_id}">
						<xen:options source="{$userGroups}"/>
					</xen:select>
					<span class="YetiShareBridge_InputSpacer"></span>
					<xen:select name="{$fieldPrefix}[{$preparedOption.option_id}][{$counter}][package_id]" 
								value="{$choice.package_id}">
						<xen:options source="{$packageOptions}"/>
					</xen:select>
				</li>
			</xen:foreach>
		
			<li class="CensorWordOptionListener YetiShareBridge_InputGroup">
				<xen:select name="{$fieldPrefix}[{$preparedOption.option_id}][{$nextCounter}][user_group_id]">
					<xen:options source="{$userGroups}"/>
				</xen:select>
				<span class="YetiShareBridge_InputSpacer"></span>
				<xen:select name="{$fieldPrefix}[{$preparedOption.option_id}][{$nextCounter}][package_id]">
					<xen:options source="{$packageOptions}"/>
				</xen:select>
			</li>
		</ul>
		
		<input type="hidden" name="{$listedFieldName}" value="{$preparedOption.option_id}" />
		{xen:raw $editLink}
	</xen:html>
</xen:controlunit>]]></template>
  </admin_templates>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="file_health_check" execute_order="10" callback_class="Truonglv_YetiShareBridge_Listener" callback_method="file_health_check" active="1" hint="" description=""/>
    <listener event_id="load_class_controller" execute_order="10" callback_class="Truonglv_YetiShareBridge_Listener" callback_method="load_class_XenForo_ControllerPublic_Login" active="1" hint="XenForo_ControllerPublic_Login" description="XenForo_ControllerPublic_Login"/>
    <listener event_id="load_class_controller" execute_order="10" callback_class="Truonglv_YetiShareBridge_Listener" callback_method="load_class_XenForo_ControllerPublic_Account" active="1" hint="XenForo_ControllerPublic_Account" description="XenForo_ControllerPublic_Account"/>
    <listener event_id="load_class_controller" execute_order="10" callback_class="Truonglv_YetiShareBridge_Listener" callback_method="load_class_XenForo_ControllerPublic_Logout" active="1" hint="XenForo_ControllerPublic_Logout" description="XenForo_ControllerPublic_Logout"/>
    <listener event_id="load_class_datawriter" execute_order="10" callback_class="Truonglv_YetiShareBridge_Listener" callback_method="load_class_XenForo_DataWriter_User" active="1" hint="XenForo_DataWriter_User" description="XenForo_DataWriter_User"/>
    <listener event_id="load_class_model" execute_order="10" callback_class="Truonglv_YetiShareBridge_Listener" callback_method="load_class_XenForo_Model_UserUpgrade" active="1" hint="XenForo_Model_UserUpgrade" description="XenForo_Model_UserUpgrade"/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups>
    <group group_id="Truonglv_YetiShareBridge" display_order="1200" debug_only="0"/>
    <option option_id="YetiShareBridge_accessToken" edit_format="callback" data_type="array" can_backup="1">
      <default_value></default_value>
      <edit_format_params>Truonglv_YetiShareBridge_Option::renderAccessToken</edit_format_params>
      <sub_options>*</sub_options>
      <relation group_id="Truonglv_YetiShareBridge" display_order="1"/>
    </option>
    <option option_id="YetiShareBridge_apiUrl" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="Truonglv_YetiShareBridge" display_order="5"/>
    </option>
    <option option_id="YetiShareBridge_baseUrl" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="Truonglv_YetiShareBridge" display_order="2"/>
    </option>
    <option option_id="YetiShareBridge_defaultPackage" edit_format="callback" data_type="unsigned_integer" can_backup="1">
      <default_value>0</default_value>
      <edit_format_params>Truonglv_YetiShareBridge_Option::renderYetisharePackages</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="Truonglv_YetiShareBridge" display_order="35"/>
    </option>
    <option option_id="YetiShareBridge_encryptKey" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="Truonglv_YetiShareBridge" display_order="220"/>
    </option>
    <option option_id="YetiShareBridge_password" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params>type=password</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="Truonglv_YetiShareBridge" display_order="16"/>
    </option>
    <option option_id="YetiShareBridge_username" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="Truonglv_YetiShareBridge" display_order="15"/>
    </option>
    <option option_id="YetiShareBridge_vipMapping" edit_format="callback" data_type="array" can_backup="1" validation_class="Truonglv_YetiShareBridge_Option" validation_method="verifyOptionVIPMapping">
      <default_value></default_value>
      <edit_format_params>Truonglv_YetiShareBridge_Option::renderVIPMapping</edit_format_params>
      <sub_options>*</sub_options>
      <relation group_id="Truonglv_YetiShareBridge" display_order="30"/>
    </option>
  </optiongroups>
  <permissions>
    <permission_groups/>
    <permissions/>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="option_group_Truonglv_YetiShareBridge" version_id="1000000" version_string="1.0.0"><![CDATA[[tl] YetiShare Bridge]]></phrase>
    <phrase title="option_group_Truonglv_YetiShareBridge_description" version_id="1000000" version_string="1.0.0"><![CDATA[]]></phrase>
    <phrase title="option_YetiShareBridge_accessToken" version_id="1000000" version_string="1.0.0"><![CDATA[Access token]]></phrase>
    <phrase title="option_YetiShareBridge_accessToken_explain" version_id="1000000" version_string="1.0.0"><![CDATA[]]></phrase>
    <phrase title="option_YetiShareBridge_apiUrl" version_id="1000000" version_string="1.0.0"><![CDATA[(YetiShare) API URL]]></phrase>
    <phrase title="option_YetiShareBridge_apiUrl_explain" version_id="1000000" version_string="1.0.0"><![CDATA[]]></phrase>
    <phrase title="option_YetiShareBridge_baseUrl" version_id="1000000" version_string="1.0.0"><![CDATA[(YetiShare) Base URL]]></phrase>
    <phrase title="option_YetiShareBridge_baseUrl_explain" version_id="1000000" version_string="1.0.0"><![CDATA[]]></phrase>
    <phrase title="option_YetiShareBridge_defaultPackage" version_id="1000000" version_string="1.0.0"><![CDATA[(YetiShare) Default Package]]></phrase>
    <phrase title="option_YetiShareBridge_defaultPackage_explain" version_id="1000000" version_string="1.0.0"><![CDATA[Gói mặc định áp dụng cho tạo TV mới hoặc khi TV bị giáng chức khỏi nhóm VIP.]]></phrase>
    <phrase title="option_YetiShareBridge_encryptKey" version_id="1000000" version_string="1.0.0"><![CDATA[Encryption Key]]></phrase>
    <phrase title="option_YetiShareBridge_encryptKey_explain" version_id="1000000" version_string="1.0.0"><![CDATA[A secret key to encrypt data. This value must be match with YetiShare plugin settings.]]></phrase>
    <phrase title="option_YetiShareBridge_password" version_id="1000000" version_string="1.0.0"><![CDATA[(YetiShare) Admin password]]></phrase>
    <phrase title="option_YetiShareBridge_password_explain" version_id="1000000" version_string="1.0.0"><![CDATA[Admin password account.]]></phrase>
    <phrase title="option_YetiShareBridge_username" version_id="1000000" version_string="1.0.0"><![CDATA[(YetiShare) Admin username]]></phrase>
    <phrase title="option_YetiShareBridge_username_explain" version_id="1000000" version_string="1.0.0"><![CDATA[The YetiShare admin username to login.]]></phrase>
    <phrase title="option_YetiShareBridge_vipMapping" version_id="1000000" version_string="1.0.0"><![CDATA[VIP Mapping]]></phrase>
    <phrase title="option_YetiShareBridge_vipMapping_explain" version_id="1000000" version_string="1.0.0"><![CDATA[Map from XenForo User Group to YetiShare package.]]></phrase>
    <phrase title="yetishare_bridge_account" version_id="1000000" version_string="1.0.0"><![CDATA[Account]]></phrase>
    <phrase title="yetishare_bridge_associate" version_id="1000000" version_string="1.0.0"><![CDATA[Associate with YetiShare]]></phrase>
    <phrase title="yetishare_bridge_error_account_disabled" version_id="1000000" version_string="1.0.0"><![CDATA[Your YetiShare account has been disabled. Please connect with other or contact with administrator to resolve it.]]></phrase>
    <phrase title="yetishare_bridge_error_account_integrated_with_other" version_id="1000000" version_string="1.0.0"><![CDATA[YetiShare account has been integrated with other account.]]></phrase>
    <phrase title="yetishare_bridge_error_invalid_api_key" version_id="1000000" version_string="1.0.0"><![CDATA[Please enter a valid api key.]]></phrase>
    <phrase title="yetishare_bridge_integration" version_id="1000000" version_string="1.0.0"><![CDATA[YetiShare Integration]]></phrase>
    <phrase title="yetishare_bridge_password" version_id="1000000" version_string="1.0.0"><![CDATA[YetiShare password]]></phrase>
    <phrase title="yetishare_bridge_username" version_id="1000000" version_string="1.0.0"><![CDATA[YetiShare username]]></phrase>
    <phrase title="yetishare_bridge_your_account_is_not_currently_associated_with_yetishare_account" version_id="1000000" version_string="1.0.0"><![CDATA[Your account is not currently associated with YetiShare account.<br/>
To associate with your YetiShare account you may provide api key1 and api key2 from your account setting in YetiShare.]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="yetishare_bridge_account_external" version_id="1000000" version_string="1.0.0"><![CDATA[<xen:if is="{$xenOptions.YetiShareBridge_apiUrl}">
	<form action="{xen:if '{$YetiShare}', '', '{xen:link account/yetishare-associate}'}" 
		  method="post" class="xenForm{xen:if 'empty({$YetiShare})', ' AutoValidator'}"{xen:if 'empty({$YetiShare})', ' data-redirect="on"'}>
		<h3 class="textHeading">{xen:phrase yetishare_bridge_integration}</h3>
		<xen:if is="{$YetiShare}">
			<dl class="ctrlUnit">
				<dt>{xen:phrase yetishare_bridge_account}:</dt>
				<dd>{$YetiShare.extraData.firstname}<span style="margin-left: 5px">({$YetiShare.extraData.email})</span></dd>
			</dl>
		<xen:else />
			<dl class="ctrlUnit">
				<dt></dt>
				<dd>{xen:string nl2br, {xen:phrase yetishare_bridge_your_account_is_not_currently_associated_with_yetishare_account}}</dd>
			</dl>
			
			<dl class="ctrlUnit">
				<dt>{xen:phrase yetishare_bridge_username}:</dt>
				<dd>
					<input type="text" name="username" value="" class="textCtrl" id="ctrl_api_key1"/>
				</dd>
			</dl>
			
			<dl class="ctrlUnit">
				<dt>{xen:phrase yetishare_bridge_password}:</dt>
				<dd>
					<input type="password" name="password" value="" class="textCtrl" id="ctrl_api_key2"/>
				</dd>
			</dl>
			
			<dl class="ctrlUnit submitUnit">
				<dt></dt>
				<dd>
					<input type="submit" value="{xen:phrase yetishare_bridge_associate}" class="button primary"/>
				</dd>
			</dl>
		</xen:if>

		<input type="hidden" name="_xfToken" value="{$visitor.csrf_token_page}" />
		<input type="hidden" name="_xfConfirm" value="1" />
	</form>
</xen:if>
<xen:edithint template="account_external_accounts"/>]]></template>
  </templates>
  <public_template_modifications>
    <modification template="account_external_accounts" modification_key="YS_" description="Add connect YetiShare button" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:if is="{$xenOptions.facebookAppId}">]]></find>
      <replace><![CDATA[<xen:include template="yetishare_bridge_account_external"/>
$0]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
